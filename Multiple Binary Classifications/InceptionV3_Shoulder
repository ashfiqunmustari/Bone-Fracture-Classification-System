{"cells":[{"cell_type":"markdown","metadata":{"id":"gibuQXZYajIi"},"source":["## **`Necessary installation`**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16895,"status":"ok","timestamp":1676974363113,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"frWuFzCx3TB5","outputId":"546c2b60-6d37-4491-b63b-316a6b4bcfdd"},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting tensorflow-io\n","  Downloading tensorflow_io-0.30.0-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (26.9 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m26.9/26.9 MB\u001b[0m \u001b[31m41.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: tensorflow-io-gcs-filesystem==0.30.0 in /usr/local/lib/python3.8/dist-packages (from tensorflow-io) (0.30.0)\n","Installing collected packages: tensorflow-io\n","Successfully installed tensorflow-io-0.30.0\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting tensorflow_addons\n","  Downloading tensorflow_addons-0.19.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.1 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.1/1.1 MB\u001b[0m \u001b[31m8.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: typeguard>=2.7 in /usr/local/lib/python3.8/dist-packages (from tensorflow_addons) (2.7.1)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from tensorflow_addons) (23.0)\n","Installing collected packages: tensorflow_addons\n","Successfully installed tensorflow_addons-0.19.0\n"]}],"source":["!pip install tensorflow-io\n","!pip install tensorflow_addons"]},{"cell_type":"markdown","metadata":{"id":"IpQgSrxTitFp"},"source":["## **`Necessary imports`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Isox4-IYaiby"},"outputs":[],"source":["import tensorflow as tf\n","import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","%matplotlib inline\n","\n","import tensorflow_addons as tfa\n","import tensorflow_io as tfio\n","from tensorflow.keras.layers import *\n","from tensorflow.keras.models import *\n","from tensorflow import keras\n","\n","from tqdm import tqdm\n","import datetime\n","import os\n","\n","# Random seed fixation\n","tf.random.set_seed(666)\n","np.random.seed(666)"]},{"cell_type":"markdown","metadata":{"id":"_diHu_qZiw7J"},"source":["## **`Cheking tensorflow version`**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8,"status":"ok","timestamp":1676974367078,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"ElWLoH5mYzqV","outputId":"4bb8ed93-c133-493a-a47b-67403bc8c04f"},"outputs":[{"output_type":"stream","name":"stdout","text":["Tensorflow version: 2.11.0\n"]}],"source":["print(f\"Tensorflow version: {tf.__version__}\")"]},{"cell_type":"markdown","metadata":{"id":"UeqdjkwWZjIC"},"source":["## **`Cheking GPU avaibility`**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1676974367807,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"L9xsfKJ3ZiUr","outputId":"db2fb3ea-b4e2-4468-d810-83af34e29449"},"outputs":[{"output_type":"stream","name":"stdout","text":["GPU AVAILABLE\n"]}],"source":["print(\"GPU AVAILABLE\" if tf.config.list_physical_devices(\"GPU\") else \"No GPU\")"]},{"cell_type":"markdown","metadata":{"id":"IVcJ-olxbYaj"},"source":["## **`Mounting Drive`**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":21210,"status":"ok","timestamp":1676974389011,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"0YKXux_la6mk","outputId":"0bbe273d-6ab4-425e-c019-15ac85068574"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /gdrive\n"]}],"source":["from google.colab import drive\n","drive.mount('/gdrive')"]},{"cell_type":"markdown","metadata":{"id":"7DOjtnTlgqqK"},"source":["## **`Data augmentation`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PcT_Z3lkgg4a"},"outputs":[],"source":["# function\n","import  cv2\n","import imgaug\n","import imageio\n","import os\n","import numpy as np\n","from imgaug import augmenters as iaa\n","\n","class DataAugmentation:\n","\tdef __init__(self, root_dir=\"\",output_dir=\"\"):\n","\t\tself.root_dir = root_dir\n","\t\tself.output_dir = output_dir\n","\t\tprint(\"Instance of the DataAugmentation class created\")\n","\n","\tdef augmentation_of_image(self, test_image, output_path):\n","\t\tself.test_image = test_image;\n","\t\tself.output_path = output_path;\n","\t\t#define the Augmenters\n","\n","\t\t#properties: A range of values signifies that one of these numbers is randmoly chosen for every augmentation for every batch\n","\n","\t\t# Apply affine transformations to each image.\n","\t\trotate = iaa.Affine(rotate=(-90,90));  \n","\t\tscale = iaa.Affine(scale={\"x\": (0.5, 0.9), \"y\": (0.5,0.9)}); \n","\t\ttranslation = iaa.Affine(translate_percent={\"x\": (-0.15, 0.15), \"y\": (-0.15, 0.15)});\n","\t\tshear = iaa.Affine(shear=(-2, 2)); #plagio parallhlogrammo wihthin a range (-8,8)\n","\t\tzoom = iaa.PerspectiveTransform(scale=(0.01, 0.15), keep_size=True) # do not change the output size of the image\n","\t\th_flip = iaa.Fliplr(1.0); # flip horizontally all images (100%)\n","\t\tv_flip = iaa.Flipud(1.0); #flip vertically all images\n","\t\tpadding=iaa.KeepSizeByResize(iaa.CropAndPad(percent=(0.05, 0.25)))#positive values correspond to padding 5%-25% of the image,but keeping the origial output size of the new image\n","\n","\n","\t\t#More augmentations\n","\t\tblur = iaa.GaussianBlur(sigma=(0, 1.22)) # blur images with a sigma 0-2,a number ofthis range is randomly chosen everytime.Low values suggested for this application\n","\t\tcontrast = iaa.contrast.LinearContrast((0.75, 1.5)); #change the contrast by a factor of 0.75 and 1.5 sampled randomly per image\n","\t\tcontrast_channels = iaa.LinearContrast((0.75, 1.5), per_channel=True) #and for 50% of all images also independently per channel:\n","\t\tsharpen = iaa.Sharpen(alpha=(0, 1.0), lightness=(0.75, 1.5)); #sharpen with an alpha from 0(no sharpening) - 1(full sharpening) and change the lightness form 0.75 to 1.5 \n","\t\tgauss_noise = iaa.AdditiveGaussianNoise(scale=0.111*255, per_channel=True) #some random gaussian noise might occur in cell images,especially when image quality is poor\n","\t\tlaplace_noise = iaa.AdditiveLaplaceNoise(scale=(0, 0.111*255)) #we choose to be in a small range, as it is logical for training the cell images\n","\n","\n","\t\t#Brightness \n","\t\tbrightness = iaa.Multiply((0.35,1.65)) #change brightness between 35% or 165% of the original image\n","\t\tbrightness_channels = iaa.Multiply((0.5, 1.5), per_channel=0.75) # change birghtness for 25% of images.For the remaining 75%, change it, but also channel-wise.\n","\n","\t\t#CHANNELS (RGB)=(Red,Green,Blue)\n","\t\tred =iaa.WithChannels(0, iaa.Add((10, 100))) #increase each Red-pixels value within the range 10-100\n","\t\tred_rot = iaa.WithChannels(0,iaa.Affine(rotate=(0, 45))) #rotate each image's red channel by 0-45 degrees\n","\t\tgreen= iaa.WithChannels(1, iaa.Add((10, 100)))#increase each Green-pixels value within the range 10-100\n","\t\tgreen_rot=iaa.WithChannels(1,iaa.Affine(rotate=(0, 45))) #rotate each image's green channel by 0-45 degrees\n","\t\tblue=iaa.WithChannels(2, iaa.Add((10, 100)))#increase each Blue-pixels value within the range 10-100\n","\t\tblue_rot=iaa.WithChannels(2,iaa.Affine(rotate=(0, 45))) #rotate each image's blue channel by 0-45 degrees\n","\n","\t\t#colors\n","\t\tchannel_shuffle =iaa.ChannelShuffle(1.0); #shuffle all images of the batch\n","\t\tgrayscale = iaa.Grayscale(1.0)\n","\t\thue_n_saturation = iaa.MultiplyHueAndSaturation((0.5, 1.5), per_channel=True) #change hue and saturation with this range of values for different values \n","\t\tadd_hue_saturation = iaa.AddToHueAndSaturation((-50, 50), per_channel=True) #add more hue and saturation to its pixels\n","\t\t#Quantize colors using k-Means clustering\n","\t\tkmeans_color = iaa.KMeansColorQuantization(n_colors=(4, 16)) #quantizes to k means 4 to 16 colors (randomly chosen). Quantizes colors up to 16 colors\n","\n","\t\t#Alpha Blending \n","\t\tblend =iaa.AlphaElementwise((0, 1.0), iaa.Grayscale((0,1.0))) ; #blend depending on which value is greater\n","\n","\t\t#Contrast augmentors\n","\t\tclahe = iaa.CLAHE(tile_grid_size_px=((3, 21),[0,2,3,4,5,6,7])) #create a clahe contrast augmentor H=(3,21) and W=(0,7)\n","\t\thistogram = iaa.HistogramEqualization() #performs histogram equalization\n","\n","\t\t#Augmentation list of metadata augmentors\n","\t\tOneofRed = iaa.OneOf( [red]);\n","\t\tOneofGreen = iaa.OneOf( [green] );\n","\t\tOneofBlue = iaa.OneOf( [blue]);\n","\t\tcontrast_n_shit = iaa.OneOf([contrast, brightness, brightness_channels]);\n","\t\tSomeAug = iaa.SomeOf(2,[rotate,scale, translation, shear, h_flip,v_flip],random_order=True);\n","\t\tSomeClahe = iaa.SomeOf(2, [clahe, iaa.CLAHE(clip_limit=(1, 10)),iaa.CLAHE(tile_grid_size_px=(3, 21)),iaa.GammaContrast((0.5, 2.0)), iaa.AllChannelsCLAHE() , iaa.AllChannelsCLAHE(clip_limit=(1, 10), per_channel=True)],random_order=True) #Random selection from clahe augmentors\n","\t\tedgedetection= iaa.OneOf([iaa.EdgeDetect(alpha=(0, 0.7)),iaa.DirectedEdgeDetect(alpha=(0, 0.7), direction=(0.0, 1.0))]);# Search in some images either for all edges or for directed edges.These edges are then marked in a black and white image and overlayed with the original image using an alpha of 0 to 0.7.\n","\t\tcanny_filter = iaa.OneOf([iaa.Canny(), iaa.Canny(alpha=(0.5, 1.0), sobel_kernel_size=[3, 7])]); #choose one of the 2 canny filter options\n","\t\tOneofNoise = iaa.OneOf([blur, gauss_noise, laplace_noise])\n","\t\tColor_1 = iaa.OneOf([channel_shuffle,grayscale, hue_n_saturation , add_hue_saturation, kmeans_color]);\n","\t\tColor_2 = iaa.OneOf([channel_shuffle,grayscale, hue_n_saturation , add_hue_saturation, kmeans_color]);\n","\t\tFlip = iaa.OneOf([histogram , v_flip, h_flip]);\n","\n","\t\t#Define the augmentors used in the DA\n","\t\tAugmentors= [SomeAug, SomeClahe, edgedetection, canny_filter, Color_1, contrast_n_shit]\n","\n","\n","\t\tfor i in range(0,6):\n","\t\t\timg = cv2.imread(test_image) #read you image\n","\t\t\timages = np.array([img for _ in range(6)], dtype=np.uint8)  # 12 is the size of the array that will hold 8 different images\n","\t\t\timages_aug = Augmentors[i].augment_images(images)  #alternate between the different augmentors for a test image\n","\t\t\tcv2.imwrite(os.path.join(output_path,test_image +\"new\"+str(i)+'.png'), images_aug[i])  #write all changed images\n","\t\t\t"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PBmTgQGDg1f6"},"outputs":[],"source":["import shutil\n","class DataAugmentation_Extension:\n","    def __init__(self, directory=\"\"):\n","      self.directory = directory\n","      print(\"Instance of DataAugmentation_Extension class created\")\n","    def printnow(self, dir):\n","      pass\n","      # print(\"Just testing that the method calling is working \"+ dir)\n","    \n","    def extend_dataset(self, directory):\n","      # print(\"HEY\")\n","      library_augment= DataAugmentation();\n","      self.directory = directory \n","\n","      if not os.path.exists(self.directory):\n","        print(\"ERROR! Couldn't find directory!\")\n","      else:\n","        print(\"Directory exists\")\n","      class_path = directory\n","      class_files = [class_path+name for name in os.listdir(class_path)]\n","      # print(class_files) #call augmentation for all class_files\n","      for i in range(len(class_files)):\n","        library_augment.augmentation_of_image(class_files[i], class_path)\n","        "]},{"cell_type":"code","execution_count":null,"metadata":{"id":"M2983J9_g8Yp"},"outputs":[],"source":["def augment_data(Bone, Type):\n","  Sets = [\"Train\", \"Valid\"]\n","  for Set in Sets: \n","    target_directory = \"/gdrive/MyDrive/BoneFractureWork/OurDataset/\"+Bone+\"/\"+Type+\"/\"+Set+\"/\"\n","    #create an instance of the class\n","    datasetda = DataAugmentation_Extension()\n","    datasetda.extend_dataset(target_directory)"]},{"cell_type":"code","source":["print(len(os.listdir(\"/gdrive/MyDrive/BoneFractureWork/OurDataset/Shoulder/Positive/Train/\")))\n","print(len(os.listdir(\"/gdrive/MyDrive/BoneFractureWork/OurDataset/Shoulder/Positive/Valid/\")))\n","print(len(os.listdir(\"/gdrive/MyDrive/BoneFractureWork/OurDataset/Shoulder/Negative/Train/\")))\n","print(len(os.listdir(\"/gdrive/MyDrive/BoneFractureWork/OurDataset/Shoulder/Negative/Valid/\")))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"mBzdEhgmhIM8","executionInfo":{"status":"ok","timestamp":1676974477580,"user_tz":-360,"elapsed":85819,"user":{"displayName":"Neloy.","userId":"12580598278832678789"}},"outputId":"39580fff-27e6-4336-dd6f-2dd9ae8b29c5"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["4168\n","278\n","4211\n","285\n"]}]},{"cell_type":"code","execution_count":null,"metadata":{"id":"d8rWtm94h41i"},"outputs":[],"source":["def different(bone, which_set):\n","\n","  P = list()\n","  N = list()\n","  Pos_dir = \"/gdrive/MyDrive/BoneFractureWork/OurDataset/\"+bone+\"/Positive/\"+which_set+\"/\"\n","  Neg_dir = \"/gdrive/MyDrive/BoneFractureWork/OurDataset/\"+bone+\"/Negative/\"+which_set+\"/\"\n","\n","  P.extend([Pos_dir+path, \"Fractured \"+bone] for path in os.listdir(Pos_dir))\n","  N.extend([Neg_dir+path, \"Non-fractured \"+bone] for path in os.listdir(Neg_dir))\n","  \n","  return P,N"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"C8uxOPH7h5mx"},"outputs":[],"source":["def Set_creation(which_set):  \n","\n","  print(f\"{which_set}:----\")\n","  Elbow_P, Elbow_N = different(\"Shoulder\", which_set)\n","\n","  IMAGES_AND_LABELS = []\n","\n","  IMAGES_AND_LABELS.extend(batch for batch in Elbow_P)\n","  IMAGES_AND_LABELS.extend(batch for batch in Elbow_N)\n","\n","  return IMAGES_AND_LABELS"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2,"status":"ok","timestamp":1676974601702,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"pxadKPmsiPhh","outputId":"2aefaca2-33ff-4790-f900-35d11e1a703b"},"outputs":[{"output_type":"stream","name":"stdout","text":["Train:----\n","Valid:----\n"]}],"source":["TRAIN_IMAGES_AND_LABELS = Set_creation(\"Train\")\n","VALID_IMAGES_AND_LABELS = Set_creation(\"Valid\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BnPRQJPLiSIp"},"outputs":[],"source":["IMAGES_AND_LABELS = TRAIN_IMAGES_AND_LABELS + VALID_IMAGES_AND_LABELS"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iqtl4QRzUhaL"},"outputs":[],"source":["IMAGES = []\n","LABELS = []\n","\n","for i in range(len(IMAGES_AND_LABELS)):\n","  IMAGES.append(IMAGES_AND_LABELS[i][0])\n","  LABELS.append(IMAGES_AND_LABELS[i][1])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UCxR33veC1RK"},"outputs":[],"source":["from sklearn import preprocessing\n","\n","La_encoder = preprocessing.LabelEncoder()\n","\n","La_encoder.fit(LABELS)\n","OHC_LABELS = La_encoder.transform(LABELS)\n","OHC_LABELS = np.reshape(OHC_LABELS, (OHC_LABELS.size, 1))\n"]},{"cell_type":"markdown","metadata":{"id":"Kjvpt0J0o5GK"},"source":["## **`Preparing the data`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"JWzESTHc6rag"},"outputs":[],"source":["BOOL_LABELS = []\n","for i in range(len(LABELS)):\n","  BOOL_LABELS.append(La_encoder.classes_ == np.array(LABELS[i]))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"A2pMIq6M650_"},"outputs":[],"source":["from sklearn.model_selection import train_test_split\n","\n","X_train, X_val_test, Y_train, Y_val_test = train_test_split(IMAGES, BOOL_LABELS, train_size=0.9, shuffle=True, stratify = BOOL_LABELS, random_state = 53)\n","\n","X_val, X_test, Y_val, Y_test = train_test_split(X_val_test, Y_val_test, test_size=0.7, shuffle=True, stratify = Y_val_test, random_state = 53)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2,"status":"ok","timestamp":1676974608566,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"e1u-Y4p861gY","outputId":"037dd0e9-b624-480b-90d5-cd254a71ae07"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["(8047, 268, 627)"]},"metadata":{},"execution_count":18}],"source":["len(X_train), len(X_val), len(X_test)"]},{"cell_type":"markdown","metadata":{"id":"_YLPKV9y61nQ"},"source":["## **`Necessary initializations`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_AfOxZZCYtg6"},"outputs":[],"source":["IMG_SIZE = 300\n","\n","NUMBER_OF_CHANNELS = 3\n","\n","INPUT_SHAPE = [IMG_SIZE, IMG_SIZE, 3]\n","\n","OUTPUT_SHAPE = len(La_encoder.classes_)\n","\n","LR = 0.0001\n","\n","BATCH_SIZE = 64\n","\n","Unique_labels = La_encoder.classes_\n","\n","EPOCHS = 10"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Ei9_VgJAnc9h"},"outputs":[],"source":["def preprocess_image(filepath):\n","  \n","  image = tf.io.read_file(filepath)\n","  image = tf.io.decode_png(image, channels=3)\n","  image = tf.image.convert_image_dtype(image, tf.float32)\n","  image = tf.image.resize(image, [IMG_SIZE, IMG_SIZE])\n","\n","  return image"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ShZ-XK2SV4Fl"},"outputs":[],"source":["def get_image_and_label(X, Y):\n","  \n","  image = preprocess_image(X)\n","  label = Y\n","\n","  return image, label"]},{"cell_type":"markdown","metadata":{"id":"kxVWDaaMY0xx"},"source":["## **`Creation of databatches`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1AP1FZ9MT44Y"},"outputs":[],"source":["def create_databatches(X, Y=None, test_data = False, cross_train = False,val_data = False, batch_size=BATCH_SIZE):\n","\n","  if test_data:\n","    print(\"Creation of test databatches..\")\n","    data = tf.data.Dataset.from_tensor_slices((tf.constant(X)))\n","    data_batch = data.map(preprocess_image).batch(batch_size)\n","  \n","  elif val_data or cross_train:\n","    if val_data: \n","      print(\"Creation of valid databatches..\")\n","    else:\n","      print(\"Creation of cross entropy databatches..\")\n","    data = tf.data.Dataset.from_tensor_slices((tf.constant(X), tf.constant(Y)))\n","    data = data.shuffle(buffer_size = len(X))\n","    data_batch = data.map(get_image_and_label).batch(batch_size)\n","  \n","  else:\n","    print(\"Creation of train databatches..\")\n","    data = tf.data.Dataset.from_tensor_slices((tf.constant(X), tf.constant(Y)))\n","    data = data.shuffle(buffer_size = len(X))\n","    data_batch = data.map(get_image_and_label).batch(batch_size)\n","  \n","  return data_batch\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2566,"status":"ok","timestamp":1676974617780,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"X3p5uRC-VQi1","outputId":"0f356652-2423-4a4c-c634-d519b3a3dac4"},"outputs":[{"output_type":"stream","name":"stdout","text":["Creation of train databatches..\n","Creation of valid databatches..\n","Creation of test databatches..\n"]}],"source":["train_ds = create_databatches(X_train, Y_train)\n","val_ds = create_databatches(X_val, Y_val, val_data = True)\n","test_ds = create_databatches(X_test, Y_test, test_data = True)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1676974617780,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"IXRTTxrwV7Td","outputId":"70cf61c0-9add-429c-cfb9-7b1126fb6685"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["((TensorSpec(shape=(None, 300, 300, 3), dtype=tf.float32, name=None),\n","  TensorSpec(shape=(None, 2), dtype=tf.bool, name=None)),\n"," TensorSpec(shape=(None, 300, 300, 3), dtype=tf.float32, name=None))"]},"metadata":{},"execution_count":24}],"source":["train_ds.element_spec, test_ds.element_spec"]},{"cell_type":"markdown","metadata":{"id":"Nox_4RwJxGm_"},"source":["## **`Save model`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"v3urPwwvxGHJ"},"outputs":[],"source":["def save_model(model, suffix = None):\n","\n","  model_path = os.path.join(\"/gdrive/MyDrive/BoneFractureWork/Saved_models/New/Models/\"+suffix, datetime.datetime.now().strftime(\"%Y_%m_%d-%H_%M_%S\"))\n","  model_dir = model_path + \".h5\"\n","\n","  model.save(filepath = model_dir)\n","\n","  return model_dir\n"]},{"cell_type":"markdown","metadata":{"id":"BOaQs2ICxvez"},"source":["## **`Load Model`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fFc9ZlG0xusj"},"outputs":[],"source":["def load_model(FilePath):\n","  \n","  model = tf.keras.models.load_model(\n","      filepath = FilePath\n","  )\n","  \n","  return model"]},{"cell_type":"markdown","metadata":{"id":"DoPFUl3Gx20y"},"source":["## **`Confusion Matrix`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_jR9n8NSx16C"},"outputs":[],"source":["from sklearn.metrics import confusion_matrix\n","import seaborn as sns\n","\n","def Confusion_matrix(Y_true, Y_pred, Labels, suffix):\n","\n","  c_m = confusion_matrix(Y_true, Y_pred)\n","\n","  Cm_Df = pd.DataFrame(c_m, index = Labels, columns = Labels)\n","\n","  # fig, ax = plt.subplots(figsize = (5,5))\n","\n","  # ax = sns.heatmap(\n","  #     Cm_Df,\n","  #     cbar = False,\n","  #     cmap = \"gnuplot\",\n","  #     annot = True,\n","  #     linewidth = 3,\n","  #     annot_kws = {\n","  #         'fontsize' : 20\n","  #     }\n","  # )\n","\n","  # # plt.suptitle(f\"Confusion matrix for {suffix}\", fontsize=20)\n","  # plt.suptitle(f\"{suffix}\", fontsize=15, color = 'purple',fontweight=\"bold\")\n","  # plt.xlabel(\"Actual Values\", fontsize=15)\n","  # plt.ylabel(\"Predicted Values\", fontsize=15)\n","  print(f\"{Cm_Df}\")\n","  # plt.show()\n"]},{"cell_type":"markdown","metadata":{"id":"GMTdpjUcx856"},"source":["## **`Accuracy`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2XIVCyBPx8pa"},"outputs":[],"source":["from sklearn.metrics import accuracy_score\n","\n","def model_accuracy(Y_true, Y_pred, suffix):\n","\n","  Accuracy = accuracy_score(Y_true, Y_pred) * 100\n","  print(f\"\\n{suffix} Model's Accuracy: {Accuracy:.2f}%\\n\")\n","  "]},{"cell_type":"markdown","metadata":{"id":"x0A1x8wUyFAr"},"source":["## **`Classification report`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4Uew_90oyEhL"},"outputs":[],"source":["from sklearn.metrics import classification_report\n","\n","def model_classification_report(Y_true, Y_pred, suffix):\n","\n","  c_r = classification_report(Y_true, Y_pred)\n","  # CR_DF = pd.DataFrame(c_r).transpose()\n","  \n","  print(f\"\\n{suffix}'s Model's classification report: \\n\")\n","  print(f\"{c_r}\")\n"]},{"cell_type":"markdown","metadata":{"id":"o4-g_wmmyKjz"},"source":["## **`Evaluate the model`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UY4Hik1HyKDU"},"outputs":[],"source":["def Model_Evaluation(Y_true, Y_pred, Labels, suffix):\n","\n","  model_accuracy(Y_true, Y_pred, suffix)\n","\n","  Confusion_matrix(Y_true, Y_pred, Labels, suffix)\n","\n","  model_classification_report(Y_true, Y_pred, suffix)\n"]},{"cell_type":"markdown","metadata":{"id":"uBJz1QOLdpFS"},"source":["## **`Callbacks`**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Lc66uoQg3VzS"},"outputs":[],"source":["# Callbacks\n","\n","import datetime\n","%load_ext tensorboard\n","\n","def Callbacks(suffix):\n","\n","  logdir = os.path.join(\"/gdrive/MyDrive/BoneFractureWork/Saved_models/New/Tensorboard_logs/\"+suffix, datetime.datetime.now().strftime(\"%Y_%m_%d-%H_%M_%S\"))\n","\n","  tensorboard_callback = tf.keras.callbacks.TensorBoard(logdir) \n","\n","  earlystopping_callback = tf.keras.callbacks.EarlyStopping( monitor = \"val_loss\", patience = 3, verbose = 1, mode = \"min\")\n","\n","  reducelroplateau_callback = tf.keras.callbacks.ReduceLROnPlateau( monitr = \"val_loss\", factor = 0.2, patience = 8, min_lr = 1e-5)\n","\n","  checkpoint_dir = os.path.join(\"/gdrive/MyDrive/BoneFractureWork/Saved_models/New/Checkpoints/\"+suffix, datetime.datetime.now().strftime(\"%Y_%m_%d-%H_%M_%S\"))\n","  \n","  File_path = checkpoint_dir+\".hdf5\"\n","\n","  modelcheckpoint_callback = tf.keras.callbacks.ModelCheckpoint( filepath = File_path, monitor = \"val_accuracy\", mode = \"max\", verbose = 1, save_best_only = True)\n","\n","  Callbacks = [tensorboard_callback, reducelroplateau_callback, modelcheckpoint_callback]\n","\n","  # Callbacks = [ tensorboard_callback, reducelroplateau_callback ]\n","\n","  # Callbacks = [tensorboard_callback]\n","\n","  return Callbacks\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"g-9MTP5le9_x"},"outputs":[],"source":["def model_compile(model, input_shape):\n","    \n","    model.compile(\n","      optimizer = tf.keras.optimizers.Adam(learning_rate = 1e-4),\n","      loss = tf.keras.losses.BinaryCrossentropy(),\n","      metrics = [\"accuracy\"]\n","    )\n","\n","    model.build(input_shape)\n","\n","    return model"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"db20ffqLezF1"},"outputs":[],"source":["def preprocess_layers(x, output_shape = OUTPUT_SHAPE):\n","\n","  x = tf.keras.layers.GlobalAveragePooling2D()(x)\n","  x = tf.keras.layers.BatchNormalization()(x)\n","  x = tf.keras.layers.Dropout(0.5)(x)\n","  x = tf.keras.layers.Dense(512, activation = \"relu\")(x)\n","  x = tf.keras.layers.Dropout(0.5)(x)\n","  x = tf.keras.layers.Dense( units = output_shape , activation='softmax')(x)\n","\n","  return x"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6LiWIePeezCi"},"outputs":[],"source":["\n","from keras.applications import InceptionV3\n","\n","def create_InceptionV3(input_shape = INPUT_SHAPE, output_shape = OUTPUT_SHAPE):\n","\n","  Inputs = tf.keras.Input(input_shape)\n","  \n","  inceptionv3 = InceptionV3( weights = \"imagenet\", include_top = False, input_tensor = Inputs )\n","  inceptionv3.trainable = False\n","\n","  for i in range(258, 311):\n","    inceptionv3.layers[i].trainable = True\n","   \n","  x = inceptionv3.output\n","  x = preprocess_layers(x, output_shape)\n","  model = tf.keras.Model(Inputs, x, name='InceptionV3')\n","\n","  return model_compile(model, input_shape) \n","  "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6986,"status":"ok","timestamp":1676977305551,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"1QUkSXGWey_C","outputId":"4197ceb8-5c89-4d09-e78b-c45b26aaed05"},"outputs":[{"output_type":"stream","name":"stdout","text":["Model: \"InceptionV3\"\n","__________________________________________________________________________________________________\n"," Layer (type)                   Output Shape         Param #     Connected to                     \n","==================================================================================================\n"," input_4 (InputLayer)           [(None, 300, 300, 3  0           []                               \n","                                )]                                                                \n","                                                                                                  \n"," conv2d_282 (Conv2D)            (None, 149, 149, 32  864         ['input_4[0][0]']                \n","                                )                                                                 \n","                                                                                                  \n"," batch_normalization_285 (Batch  (None, 149, 149, 32  96         ['conv2d_282[0][0]']             \n"," Normalization)                 )                                                                 \n","                                                                                                  \n"," activation_282 (Activation)    (None, 149, 149, 32  0           ['batch_normalization_285[0][0]']\n","                                )                                                                 \n","                                                                                                  \n"," conv2d_283 (Conv2D)            (None, 147, 147, 32  9216        ['activation_282[0][0]']         \n","                                )                                                                 \n","                                                                                                  \n"," batch_normalization_286 (Batch  (None, 147, 147, 32  96         ['conv2d_283[0][0]']             \n"," Normalization)                 )                                                                 \n","                                                                                                  \n"," activation_283 (Activation)    (None, 147, 147, 32  0           ['batch_normalization_286[0][0]']\n","                                )                                                                 \n","                                                                                                  \n"," conv2d_284 (Conv2D)            (None, 147, 147, 64  18432       ['activation_283[0][0]']         \n","                                )                                                                 \n","                                                                                                  \n"," batch_normalization_287 (Batch  (None, 147, 147, 64  192        ['conv2d_284[0][0]']             \n"," Normalization)                 )                                                                 \n","                                                                                                  \n"," activation_284 (Activation)    (None, 147, 147, 64  0           ['batch_normalization_287[0][0]']\n","                                )                                                                 \n","                                                                                                  \n"," max_pooling2d_12 (MaxPooling2D  (None, 73, 73, 64)  0           ['activation_284[0][0]']         \n"," )                                                                                                \n","                                                                                                  \n"," conv2d_285 (Conv2D)            (None, 73, 73, 80)   5120        ['max_pooling2d_12[0][0]']       \n","                                                                                                  \n"," batch_normalization_288 (Batch  (None, 73, 73, 80)  240         ['conv2d_285[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_285 (Activation)    (None, 73, 73, 80)   0           ['batch_normalization_288[0][0]']\n","                                                                                                  \n"," conv2d_286 (Conv2D)            (None, 71, 71, 192)  138240      ['activation_285[0][0]']         \n","                                                                                                  \n"," batch_normalization_289 (Batch  (None, 71, 71, 192)  576        ['conv2d_286[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_286 (Activation)    (None, 71, 71, 192)  0           ['batch_normalization_289[0][0]']\n","                                                                                                  \n"," max_pooling2d_13 (MaxPooling2D  (None, 35, 35, 192)  0          ['activation_286[0][0]']         \n"," )                                                                                                \n","                                                                                                  \n"," conv2d_290 (Conv2D)            (None, 35, 35, 64)   12288       ['max_pooling2d_13[0][0]']       \n","                                                                                                  \n"," batch_normalization_293 (Batch  (None, 35, 35, 64)  192         ['conv2d_290[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_290 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_293[0][0]']\n","                                                                                                  \n"," conv2d_288 (Conv2D)            (None, 35, 35, 48)   9216        ['max_pooling2d_13[0][0]']       \n","                                                                                                  \n"," conv2d_291 (Conv2D)            (None, 35, 35, 96)   55296       ['activation_290[0][0]']         \n","                                                                                                  \n"," batch_normalization_291 (Batch  (None, 35, 35, 48)  144         ['conv2d_288[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_294 (Batch  (None, 35, 35, 96)  288         ['conv2d_291[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_288 (Activation)    (None, 35, 35, 48)   0           ['batch_normalization_291[0][0]']\n","                                                                                                  \n"," activation_291 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_294[0][0]']\n","                                                                                                  \n"," average_pooling2d_27 (AverageP  (None, 35, 35, 192)  0          ['max_pooling2d_13[0][0]']       \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_287 (Conv2D)            (None, 35, 35, 64)   12288       ['max_pooling2d_13[0][0]']       \n","                                                                                                  \n"," conv2d_289 (Conv2D)            (None, 35, 35, 64)   76800       ['activation_288[0][0]']         \n","                                                                                                  \n"," conv2d_292 (Conv2D)            (None, 35, 35, 96)   82944       ['activation_291[0][0]']         \n","                                                                                                  \n"," conv2d_293 (Conv2D)            (None, 35, 35, 32)   6144        ['average_pooling2d_27[0][0]']   \n","                                                                                                  \n"," batch_normalization_290 (Batch  (None, 35, 35, 64)  192         ['conv2d_287[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_292 (Batch  (None, 35, 35, 64)  192         ['conv2d_289[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_295 (Batch  (None, 35, 35, 96)  288         ['conv2d_292[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_296 (Batch  (None, 35, 35, 32)  96          ['conv2d_293[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_287 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_290[0][0]']\n","                                                                                                  \n"," activation_289 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_292[0][0]']\n","                                                                                                  \n"," activation_292 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_295[0][0]']\n","                                                                                                  \n"," activation_293 (Activation)    (None, 35, 35, 32)   0           ['batch_normalization_296[0][0]']\n","                                                                                                  \n"," mixed0 (Concatenate)           (None, 35, 35, 256)  0           ['activation_287[0][0]',         \n","                                                                  'activation_289[0][0]',         \n","                                                                  'activation_292[0][0]',         \n","                                                                  'activation_293[0][0]']         \n","                                                                                                  \n"," conv2d_297 (Conv2D)            (None, 35, 35, 64)   16384       ['mixed0[0][0]']                 \n","                                                                                                  \n"," batch_normalization_300 (Batch  (None, 35, 35, 64)  192         ['conv2d_297[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_297 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_300[0][0]']\n","                                                                                                  \n"," conv2d_295 (Conv2D)            (None, 35, 35, 48)   12288       ['mixed0[0][0]']                 \n","                                                                                                  \n"," conv2d_298 (Conv2D)            (None, 35, 35, 96)   55296       ['activation_297[0][0]']         \n","                                                                                                  \n"," batch_normalization_298 (Batch  (None, 35, 35, 48)  144         ['conv2d_295[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_301 (Batch  (None, 35, 35, 96)  288         ['conv2d_298[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_295 (Activation)    (None, 35, 35, 48)   0           ['batch_normalization_298[0][0]']\n","                                                                                                  \n"," activation_298 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_301[0][0]']\n","                                                                                                  \n"," average_pooling2d_28 (AverageP  (None, 35, 35, 256)  0          ['mixed0[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_294 (Conv2D)            (None, 35, 35, 64)   16384       ['mixed0[0][0]']                 \n","                                                                                                  \n"," conv2d_296 (Conv2D)            (None, 35, 35, 64)   76800       ['activation_295[0][0]']         \n","                                                                                                  \n"," conv2d_299 (Conv2D)            (None, 35, 35, 96)   82944       ['activation_298[0][0]']         \n","                                                                                                  \n"," conv2d_300 (Conv2D)            (None, 35, 35, 64)   16384       ['average_pooling2d_28[0][0]']   \n","                                                                                                  \n"," batch_normalization_297 (Batch  (None, 35, 35, 64)  192         ['conv2d_294[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_299 (Batch  (None, 35, 35, 64)  192         ['conv2d_296[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_302 (Batch  (None, 35, 35, 96)  288         ['conv2d_299[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_303 (Batch  (None, 35, 35, 64)  192         ['conv2d_300[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_294 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_297[0][0]']\n","                                                                                                  \n"," activation_296 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_299[0][0]']\n","                                                                                                  \n"," activation_299 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_302[0][0]']\n","                                                                                                  \n"," activation_300 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_303[0][0]']\n","                                                                                                  \n"," mixed1 (Concatenate)           (None, 35, 35, 288)  0           ['activation_294[0][0]',         \n","                                                                  'activation_296[0][0]',         \n","                                                                  'activation_299[0][0]',         \n","                                                                  'activation_300[0][0]']         \n","                                                                                                  \n"," conv2d_304 (Conv2D)            (None, 35, 35, 64)   18432       ['mixed1[0][0]']                 \n","                                                                                                  \n"," batch_normalization_307 (Batch  (None, 35, 35, 64)  192         ['conv2d_304[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_304 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_307[0][0]']\n","                                                                                                  \n"," conv2d_302 (Conv2D)            (None, 35, 35, 48)   13824       ['mixed1[0][0]']                 \n","                                                                                                  \n"," conv2d_305 (Conv2D)            (None, 35, 35, 96)   55296       ['activation_304[0][0]']         \n","                                                                                                  \n"," batch_normalization_305 (Batch  (None, 35, 35, 48)  144         ['conv2d_302[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_308 (Batch  (None, 35, 35, 96)  288         ['conv2d_305[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_302 (Activation)    (None, 35, 35, 48)   0           ['batch_normalization_305[0][0]']\n","                                                                                                  \n"," activation_305 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_308[0][0]']\n","                                                                                                  \n"," average_pooling2d_29 (AverageP  (None, 35, 35, 288)  0          ['mixed1[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_301 (Conv2D)            (None, 35, 35, 64)   18432       ['mixed1[0][0]']                 \n","                                                                                                  \n"," conv2d_303 (Conv2D)            (None, 35, 35, 64)   76800       ['activation_302[0][0]']         \n","                                                                                                  \n"," conv2d_306 (Conv2D)            (None, 35, 35, 96)   82944       ['activation_305[0][0]']         \n","                                                                                                  \n"," conv2d_307 (Conv2D)            (None, 35, 35, 64)   18432       ['average_pooling2d_29[0][0]']   \n","                                                                                                  \n"," batch_normalization_304 (Batch  (None, 35, 35, 64)  192         ['conv2d_301[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_306 (Batch  (None, 35, 35, 64)  192         ['conv2d_303[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_309 (Batch  (None, 35, 35, 96)  288         ['conv2d_306[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_310 (Batch  (None, 35, 35, 64)  192         ['conv2d_307[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_301 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_304[0][0]']\n","                                                                                                  \n"," activation_303 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_306[0][0]']\n","                                                                                                  \n"," activation_306 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_309[0][0]']\n","                                                                                                  \n"," activation_307 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_310[0][0]']\n","                                                                                                  \n"," mixed2 (Concatenate)           (None, 35, 35, 288)  0           ['activation_301[0][0]',         \n","                                                                  'activation_303[0][0]',         \n","                                                                  'activation_306[0][0]',         \n","                                                                  'activation_307[0][0]']         \n","                                                                                                  \n"," conv2d_309 (Conv2D)            (None, 35, 35, 64)   18432       ['mixed2[0][0]']                 \n","                                                                                                  \n"," batch_normalization_312 (Batch  (None, 35, 35, 64)  192         ['conv2d_309[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_309 (Activation)    (None, 35, 35, 64)   0           ['batch_normalization_312[0][0]']\n","                                                                                                  \n"," conv2d_310 (Conv2D)            (None, 35, 35, 96)   55296       ['activation_309[0][0]']         \n","                                                                                                  \n"," batch_normalization_313 (Batch  (None, 35, 35, 96)  288         ['conv2d_310[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_310 (Activation)    (None, 35, 35, 96)   0           ['batch_normalization_313[0][0]']\n","                                                                                                  \n"," conv2d_308 (Conv2D)            (None, 17, 17, 384)  995328      ['mixed2[0][0]']                 \n","                                                                                                  \n"," conv2d_311 (Conv2D)            (None, 17, 17, 96)   82944       ['activation_310[0][0]']         \n","                                                                                                  \n"," batch_normalization_311 (Batch  (None, 17, 17, 384)  1152       ['conv2d_308[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_314 (Batch  (None, 17, 17, 96)  288         ['conv2d_311[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_308 (Activation)    (None, 17, 17, 384)  0           ['batch_normalization_311[0][0]']\n","                                                                                                  \n"," activation_311 (Activation)    (None, 17, 17, 96)   0           ['batch_normalization_314[0][0]']\n","                                                                                                  \n"," max_pooling2d_14 (MaxPooling2D  (None, 17, 17, 288)  0          ['mixed2[0][0]']                 \n"," )                                                                                                \n","                                                                                                  \n"," mixed3 (Concatenate)           (None, 17, 17, 768)  0           ['activation_308[0][0]',         \n","                                                                  'activation_311[0][0]',         \n","                                                                  'max_pooling2d_14[0][0]']       \n","                                                                                                  \n"," conv2d_316 (Conv2D)            (None, 17, 17, 128)  98304       ['mixed3[0][0]']                 \n","                                                                                                  \n"," batch_normalization_319 (Batch  (None, 17, 17, 128)  384        ['conv2d_316[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_316 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_319[0][0]']\n","                                                                                                  \n"," conv2d_317 (Conv2D)            (None, 17, 17, 128)  114688      ['activation_316[0][0]']         \n","                                                                                                  \n"," batch_normalization_320 (Batch  (None, 17, 17, 128)  384        ['conv2d_317[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_317 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_320[0][0]']\n","                                                                                                  \n"," conv2d_313 (Conv2D)            (None, 17, 17, 128)  98304       ['mixed3[0][0]']                 \n","                                                                                                  \n"," conv2d_318 (Conv2D)            (None, 17, 17, 128)  114688      ['activation_317[0][0]']         \n","                                                                                                  \n"," batch_normalization_316 (Batch  (None, 17, 17, 128)  384        ['conv2d_313[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_321 (Batch  (None, 17, 17, 128)  384        ['conv2d_318[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_313 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_316[0][0]']\n","                                                                                                  \n"," activation_318 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_321[0][0]']\n","                                                                                                  \n"," conv2d_314 (Conv2D)            (None, 17, 17, 128)  114688      ['activation_313[0][0]']         \n","                                                                                                  \n"," conv2d_319 (Conv2D)            (None, 17, 17, 128)  114688      ['activation_318[0][0]']         \n","                                                                                                  \n"," batch_normalization_317 (Batch  (None, 17, 17, 128)  384        ['conv2d_314[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_322 (Batch  (None, 17, 17, 128)  384        ['conv2d_319[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_314 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_317[0][0]']\n","                                                                                                  \n"," activation_319 (Activation)    (None, 17, 17, 128)  0           ['batch_normalization_322[0][0]']\n","                                                                                                  \n"," average_pooling2d_30 (AverageP  (None, 17, 17, 768)  0          ['mixed3[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_312 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed3[0][0]']                 \n","                                                                                                  \n"," conv2d_315 (Conv2D)            (None, 17, 17, 192)  172032      ['activation_314[0][0]']         \n","                                                                                                  \n"," conv2d_320 (Conv2D)            (None, 17, 17, 192)  172032      ['activation_319[0][0]']         \n","                                                                                                  \n"," conv2d_321 (Conv2D)            (None, 17, 17, 192)  147456      ['average_pooling2d_30[0][0]']   \n","                                                                                                  \n"," batch_normalization_315 (Batch  (None, 17, 17, 192)  576        ['conv2d_312[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_318 (Batch  (None, 17, 17, 192)  576        ['conv2d_315[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_323 (Batch  (None, 17, 17, 192)  576        ['conv2d_320[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_324 (Batch  (None, 17, 17, 192)  576        ['conv2d_321[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_312 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_315[0][0]']\n","                                                                                                  \n"," activation_315 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_318[0][0]']\n","                                                                                                  \n"," activation_320 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_323[0][0]']\n","                                                                                                  \n"," activation_321 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_324[0][0]']\n","                                                                                                  \n"," mixed4 (Concatenate)           (None, 17, 17, 768)  0           ['activation_312[0][0]',         \n","                                                                  'activation_315[0][0]',         \n","                                                                  'activation_320[0][0]',         \n","                                                                  'activation_321[0][0]']         \n","                                                                                                  \n"," conv2d_326 (Conv2D)            (None, 17, 17, 160)  122880      ['mixed4[0][0]']                 \n","                                                                                                  \n"," batch_normalization_329 (Batch  (None, 17, 17, 160)  480        ['conv2d_326[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_326 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_329[0][0]']\n","                                                                                                  \n"," conv2d_327 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_326[0][0]']         \n","                                                                                                  \n"," batch_normalization_330 (Batch  (None, 17, 17, 160)  480        ['conv2d_327[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_327 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_330[0][0]']\n","                                                                                                  \n"," conv2d_323 (Conv2D)            (None, 17, 17, 160)  122880      ['mixed4[0][0]']                 \n","                                                                                                  \n"," conv2d_328 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_327[0][0]']         \n","                                                                                                  \n"," batch_normalization_326 (Batch  (None, 17, 17, 160)  480        ['conv2d_323[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_331 (Batch  (None, 17, 17, 160)  480        ['conv2d_328[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_323 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_326[0][0]']\n","                                                                                                  \n"," activation_328 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_331[0][0]']\n","                                                                                                  \n"," conv2d_324 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_323[0][0]']         \n","                                                                                                  \n"," conv2d_329 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_328[0][0]']         \n","                                                                                                  \n"," batch_normalization_327 (Batch  (None, 17, 17, 160)  480        ['conv2d_324[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_332 (Batch  (None, 17, 17, 160)  480        ['conv2d_329[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_324 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_327[0][0]']\n","                                                                                                  \n"," activation_329 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_332[0][0]']\n","                                                                                                  \n"," average_pooling2d_31 (AverageP  (None, 17, 17, 768)  0          ['mixed4[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_322 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed4[0][0]']                 \n","                                                                                                  \n"," conv2d_325 (Conv2D)            (None, 17, 17, 192)  215040      ['activation_324[0][0]']         \n","                                                                                                  \n"," conv2d_330 (Conv2D)            (None, 17, 17, 192)  215040      ['activation_329[0][0]']         \n","                                                                                                  \n"," conv2d_331 (Conv2D)            (None, 17, 17, 192)  147456      ['average_pooling2d_31[0][0]']   \n","                                                                                                  \n"," batch_normalization_325 (Batch  (None, 17, 17, 192)  576        ['conv2d_322[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_328 (Batch  (None, 17, 17, 192)  576        ['conv2d_325[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_333 (Batch  (None, 17, 17, 192)  576        ['conv2d_330[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_334 (Batch  (None, 17, 17, 192)  576        ['conv2d_331[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_322 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_325[0][0]']\n","                                                                                                  \n"," activation_325 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_328[0][0]']\n","                                                                                                  \n"," activation_330 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_333[0][0]']\n","                                                                                                  \n"," activation_331 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_334[0][0]']\n","                                                                                                  \n"," mixed5 (Concatenate)           (None, 17, 17, 768)  0           ['activation_322[0][0]',         \n","                                                                  'activation_325[0][0]',         \n","                                                                  'activation_330[0][0]',         \n","                                                                  'activation_331[0][0]']         \n","                                                                                                  \n"," conv2d_336 (Conv2D)            (None, 17, 17, 160)  122880      ['mixed5[0][0]']                 \n","                                                                                                  \n"," batch_normalization_339 (Batch  (None, 17, 17, 160)  480        ['conv2d_336[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_336 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_339[0][0]']\n","                                                                                                  \n"," conv2d_337 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_336[0][0]']         \n","                                                                                                  \n"," batch_normalization_340 (Batch  (None, 17, 17, 160)  480        ['conv2d_337[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_337 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_340[0][0]']\n","                                                                                                  \n"," conv2d_333 (Conv2D)            (None, 17, 17, 160)  122880      ['mixed5[0][0]']                 \n","                                                                                                  \n"," conv2d_338 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_337[0][0]']         \n","                                                                                                  \n"," batch_normalization_336 (Batch  (None, 17, 17, 160)  480        ['conv2d_333[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_341 (Batch  (None, 17, 17, 160)  480        ['conv2d_338[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_333 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_336[0][0]']\n","                                                                                                  \n"," activation_338 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_341[0][0]']\n","                                                                                                  \n"," conv2d_334 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_333[0][0]']         \n","                                                                                                  \n"," conv2d_339 (Conv2D)            (None, 17, 17, 160)  179200      ['activation_338[0][0]']         \n","                                                                                                  \n"," batch_normalization_337 (Batch  (None, 17, 17, 160)  480        ['conv2d_334[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_342 (Batch  (None, 17, 17, 160)  480        ['conv2d_339[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_334 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_337[0][0]']\n","                                                                                                  \n"," activation_339 (Activation)    (None, 17, 17, 160)  0           ['batch_normalization_342[0][0]']\n","                                                                                                  \n"," average_pooling2d_32 (AverageP  (None, 17, 17, 768)  0          ['mixed5[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_332 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed5[0][0]']                 \n","                                                                                                  \n"," conv2d_335 (Conv2D)            (None, 17, 17, 192)  215040      ['activation_334[0][0]']         \n","                                                                                                  \n"," conv2d_340 (Conv2D)            (None, 17, 17, 192)  215040      ['activation_339[0][0]']         \n","                                                                                                  \n"," conv2d_341 (Conv2D)            (None, 17, 17, 192)  147456      ['average_pooling2d_32[0][0]']   \n","                                                                                                  \n"," batch_normalization_335 (Batch  (None, 17, 17, 192)  576        ['conv2d_332[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_338 (Batch  (None, 17, 17, 192)  576        ['conv2d_335[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_343 (Batch  (None, 17, 17, 192)  576        ['conv2d_340[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_344 (Batch  (None, 17, 17, 192)  576        ['conv2d_341[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_332 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_335[0][0]']\n","                                                                                                  \n"," activation_335 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_338[0][0]']\n","                                                                                                  \n"," activation_340 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_343[0][0]']\n","                                                                                                  \n"," activation_341 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_344[0][0]']\n","                                                                                                  \n"," mixed6 (Concatenate)           (None, 17, 17, 768)  0           ['activation_332[0][0]',         \n","                                                                  'activation_335[0][0]',         \n","                                                                  'activation_340[0][0]',         \n","                                                                  'activation_341[0][0]']         \n","                                                                                                  \n"," conv2d_346 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed6[0][0]']                 \n","                                                                                                  \n"," batch_normalization_349 (Batch  (None, 17, 17, 192)  576        ['conv2d_346[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_346 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_349[0][0]']\n","                                                                                                  \n"," conv2d_347 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_346[0][0]']         \n","                                                                                                  \n"," batch_normalization_350 (Batch  (None, 17, 17, 192)  576        ['conv2d_347[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_347 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_350[0][0]']\n","                                                                                                  \n"," conv2d_343 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed6[0][0]']                 \n","                                                                                                  \n"," conv2d_348 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_347[0][0]']         \n","                                                                                                  \n"," batch_normalization_346 (Batch  (None, 17, 17, 192)  576        ['conv2d_343[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_351 (Batch  (None, 17, 17, 192)  576        ['conv2d_348[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_343 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_346[0][0]']\n","                                                                                                  \n"," activation_348 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_351[0][0]']\n","                                                                                                  \n"," conv2d_344 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_343[0][0]']         \n","                                                                                                  \n"," conv2d_349 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_348[0][0]']         \n","                                                                                                  \n"," batch_normalization_347 (Batch  (None, 17, 17, 192)  576        ['conv2d_344[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_352 (Batch  (None, 17, 17, 192)  576        ['conv2d_349[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_344 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_347[0][0]']\n","                                                                                                  \n"," activation_349 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_352[0][0]']\n","                                                                                                  \n"," average_pooling2d_33 (AverageP  (None, 17, 17, 768)  0          ['mixed6[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_342 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed6[0][0]']                 \n","                                                                                                  \n"," conv2d_345 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_344[0][0]']         \n","                                                                                                  \n"," conv2d_350 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_349[0][0]']         \n","                                                                                                  \n"," conv2d_351 (Conv2D)            (None, 17, 17, 192)  147456      ['average_pooling2d_33[0][0]']   \n","                                                                                                  \n"," batch_normalization_345 (Batch  (None, 17, 17, 192)  576        ['conv2d_342[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_348 (Batch  (None, 17, 17, 192)  576        ['conv2d_345[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_353 (Batch  (None, 17, 17, 192)  576        ['conv2d_350[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_354 (Batch  (None, 17, 17, 192)  576        ['conv2d_351[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_342 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_345[0][0]']\n","                                                                                                  \n"," activation_345 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_348[0][0]']\n","                                                                                                  \n"," activation_350 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_353[0][0]']\n","                                                                                                  \n"," activation_351 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_354[0][0]']\n","                                                                                                  \n"," mixed7 (Concatenate)           (None, 17, 17, 768)  0           ['activation_342[0][0]',         \n","                                                                  'activation_345[0][0]',         \n","                                                                  'activation_350[0][0]',         \n","                                                                  'activation_351[0][0]']         \n","                                                                                                  \n"," conv2d_354 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed7[0][0]']                 \n","                                                                                                  \n"," batch_normalization_357 (Batch  (None, 17, 17, 192)  576        ['conv2d_354[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_354 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_357[0][0]']\n","                                                                                                  \n"," conv2d_355 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_354[0][0]']         \n","                                                                                                  \n"," batch_normalization_358 (Batch  (None, 17, 17, 192)  576        ['conv2d_355[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_355 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_358[0][0]']\n","                                                                                                  \n"," conv2d_352 (Conv2D)            (None, 17, 17, 192)  147456      ['mixed7[0][0]']                 \n","                                                                                                  \n"," conv2d_356 (Conv2D)            (None, 17, 17, 192)  258048      ['activation_355[0][0]']         \n","                                                                                                  \n"," batch_normalization_355 (Batch  (None, 17, 17, 192)  576        ['conv2d_352[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_359 (Batch  (None, 17, 17, 192)  576        ['conv2d_356[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_352 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_355[0][0]']\n","                                                                                                  \n"," activation_356 (Activation)    (None, 17, 17, 192)  0           ['batch_normalization_359[0][0]']\n","                                                                                                  \n"," conv2d_353 (Conv2D)            (None, 8, 8, 320)    552960      ['activation_352[0][0]']         \n","                                                                                                  \n"," conv2d_357 (Conv2D)            (None, 8, 8, 192)    331776      ['activation_356[0][0]']         \n","                                                                                                  \n"," batch_normalization_356 (Batch  (None, 8, 8, 320)   960         ['conv2d_353[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_360 (Batch  (None, 8, 8, 192)   576         ['conv2d_357[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_353 (Activation)    (None, 8, 8, 320)    0           ['batch_normalization_356[0][0]']\n","                                                                                                  \n"," activation_357 (Activation)    (None, 8, 8, 192)    0           ['batch_normalization_360[0][0]']\n","                                                                                                  \n"," max_pooling2d_15 (MaxPooling2D  (None, 8, 8, 768)   0           ['mixed7[0][0]']                 \n"," )                                                                                                \n","                                                                                                  \n"," mixed8 (Concatenate)           (None, 8, 8, 1280)   0           ['activation_353[0][0]',         \n","                                                                  'activation_357[0][0]',         \n","                                                                  'max_pooling2d_15[0][0]']       \n","                                                                                                  \n"," conv2d_362 (Conv2D)            (None, 8, 8, 448)    573440      ['mixed8[0][0]']                 \n","                                                                                                  \n"," batch_normalization_365 (Batch  (None, 8, 8, 448)   1344        ['conv2d_362[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_362 (Activation)    (None, 8, 8, 448)    0           ['batch_normalization_365[0][0]']\n","                                                                                                  \n"," conv2d_359 (Conv2D)            (None, 8, 8, 384)    491520      ['mixed8[0][0]']                 \n","                                                                                                  \n"," conv2d_363 (Conv2D)            (None, 8, 8, 384)    1548288     ['activation_362[0][0]']         \n","                                                                                                  \n"," batch_normalization_362 (Batch  (None, 8, 8, 384)   1152        ['conv2d_359[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_366 (Batch  (None, 8, 8, 384)   1152        ['conv2d_363[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_359 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_362[0][0]']\n","                                                                                                  \n"," activation_363 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_366[0][0]']\n","                                                                                                  \n"," conv2d_360 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_359[0][0]']         \n","                                                                                                  \n"," conv2d_361 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_359[0][0]']         \n","                                                                                                  \n"," conv2d_364 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_363[0][0]']         \n","                                                                                                  \n"," conv2d_365 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_363[0][0]']         \n","                                                                                                  \n"," average_pooling2d_34 (AverageP  (None, 8, 8, 1280)  0           ['mixed8[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_358 (Conv2D)            (None, 8, 8, 320)    409600      ['mixed8[0][0]']                 \n","                                                                                                  \n"," batch_normalization_363 (Batch  (None, 8, 8, 384)   1152        ['conv2d_360[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_364 (Batch  (None, 8, 8, 384)   1152        ['conv2d_361[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_367 (Batch  (None, 8, 8, 384)   1152        ['conv2d_364[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_368 (Batch  (None, 8, 8, 384)   1152        ['conv2d_365[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," conv2d_366 (Conv2D)            (None, 8, 8, 192)    245760      ['average_pooling2d_34[0][0]']   \n","                                                                                                  \n"," batch_normalization_361 (Batch  (None, 8, 8, 320)   960         ['conv2d_358[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_360 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_363[0][0]']\n","                                                                                                  \n"," activation_361 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_364[0][0]']\n","                                                                                                  \n"," activation_364 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_367[0][0]']\n","                                                                                                  \n"," activation_365 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_368[0][0]']\n","                                                                                                  \n"," batch_normalization_369 (Batch  (None, 8, 8, 192)   576         ['conv2d_366[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_358 (Activation)    (None, 8, 8, 320)    0           ['batch_normalization_361[0][0]']\n","                                                                                                  \n"," mixed9_0 (Concatenate)         (None, 8, 8, 768)    0           ['activation_360[0][0]',         \n","                                                                  'activation_361[0][0]']         \n","                                                                                                  \n"," concatenate_6 (Concatenate)    (None, 8, 8, 768)    0           ['activation_364[0][0]',         \n","                                                                  'activation_365[0][0]']         \n","                                                                                                  \n"," activation_366 (Activation)    (None, 8, 8, 192)    0           ['batch_normalization_369[0][0]']\n","                                                                                                  \n"," mixed9 (Concatenate)           (None, 8, 8, 2048)   0           ['activation_358[0][0]',         \n","                                                                  'mixed9_0[0][0]',               \n","                                                                  'concatenate_6[0][0]',          \n","                                                                  'activation_366[0][0]']         \n","                                                                                                  \n"," conv2d_371 (Conv2D)            (None, 8, 8, 448)    917504      ['mixed9[0][0]']                 \n","                                                                                                  \n"," batch_normalization_374 (Batch  (None, 8, 8, 448)   1344        ['conv2d_371[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_371 (Activation)    (None, 8, 8, 448)    0           ['batch_normalization_374[0][0]']\n","                                                                                                  \n"," conv2d_368 (Conv2D)            (None, 8, 8, 384)    786432      ['mixed9[0][0]']                 \n","                                                                                                  \n"," conv2d_372 (Conv2D)            (None, 8, 8, 384)    1548288     ['activation_371[0][0]']         \n","                                                                                                  \n"," batch_normalization_371 (Batch  (None, 8, 8, 384)   1152        ['conv2d_368[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_375 (Batch  (None, 8, 8, 384)   1152        ['conv2d_372[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_368 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_371[0][0]']\n","                                                                                                  \n"," activation_372 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_375[0][0]']\n","                                                                                                  \n"," conv2d_369 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_368[0][0]']         \n","                                                                                                  \n"," conv2d_370 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_368[0][0]']         \n","                                                                                                  \n"," conv2d_373 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_372[0][0]']         \n","                                                                                                  \n"," conv2d_374 (Conv2D)            (None, 8, 8, 384)    442368      ['activation_372[0][0]']         \n","                                                                                                  \n"," average_pooling2d_35 (AverageP  (None, 8, 8, 2048)  0           ['mixed9[0][0]']                 \n"," ooling2D)                                                                                        \n","                                                                                                  \n"," conv2d_367 (Conv2D)            (None, 8, 8, 320)    655360      ['mixed9[0][0]']                 \n","                                                                                                  \n"," batch_normalization_372 (Batch  (None, 8, 8, 384)   1152        ['conv2d_369[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_373 (Batch  (None, 8, 8, 384)   1152        ['conv2d_370[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_376 (Batch  (None, 8, 8, 384)   1152        ['conv2d_373[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," batch_normalization_377 (Batch  (None, 8, 8, 384)   1152        ['conv2d_374[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," conv2d_375 (Conv2D)            (None, 8, 8, 192)    393216      ['average_pooling2d_35[0][0]']   \n","                                                                                                  \n"," batch_normalization_370 (Batch  (None, 8, 8, 320)   960         ['conv2d_367[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_369 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_372[0][0]']\n","                                                                                                  \n"," activation_370 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_373[0][0]']\n","                                                                                                  \n"," activation_373 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_376[0][0]']\n","                                                                                                  \n"," activation_374 (Activation)    (None, 8, 8, 384)    0           ['batch_normalization_377[0][0]']\n","                                                                                                  \n"," batch_normalization_378 (Batch  (None, 8, 8, 192)   576         ['conv2d_375[0][0]']             \n"," Normalization)                                                                                   \n","                                                                                                  \n"," activation_367 (Activation)    (None, 8, 8, 320)    0           ['batch_normalization_370[0][0]']\n","                                                                                                  \n"," mixed9_1 (Concatenate)         (None, 8, 8, 768)    0           ['activation_369[0][0]',         \n","                                                                  'activation_370[0][0]']         \n","                                                                                                  \n"," concatenate_7 (Concatenate)    (None, 8, 8, 768)    0           ['activation_373[0][0]',         \n","                                                                  'activation_374[0][0]']         \n","                                                                                                  \n"," activation_375 (Activation)    (None, 8, 8, 192)    0           ['batch_normalization_378[0][0]']\n","                                                                                                  \n"," mixed10 (Concatenate)          (None, 8, 8, 2048)   0           ['activation_367[0][0]',         \n","                                                                  'mixed9_1[0][0]',               \n","                                                                  'concatenate_7[0][0]',          \n","                                                                  'activation_375[0][0]']         \n","                                                                                                  \n"," global_average_pooling2d_3 (Gl  (None, 2048)        0           ['mixed10[0][0]']                \n"," obalAveragePooling2D)                                                                            \n","                                                                                                  \n"," batch_normalization_379 (Batch  (None, 2048)        8192        ['global_average_pooling2d_3[0][0\n"," Normalization)                                                  ]']                              \n","                                                                                                  \n"," dropout_8 (Dropout)            (None, 2048)         0           ['batch_normalization_379[0][0]']\n","                                                                                                  \n"," dense_8 (Dense)                (None, 512)          1049088     ['dropout_8[0][0]']              \n","                                                                                                  \n"," dropout_9 (Dropout)            (None, 512)          0           ['dense_8[0][0]']                \n","                                                                                                  \n"," dense_9 (Dense)                (None, 2)            1026        ['dropout_9[0][0]']              \n","                                                                                                  \n","==================================================================================================\n","Total params: 22,861,090\n","Trainable params: 9,554,626\n","Non-trainable params: 13,306,464\n","__________________________________________________________________________________________________\n"]}],"source":["\n","Model_InceptionV3 = create_InceptionV3()\n","\n","Model_InceptionV3.summary()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":798},"id":"hmfUsVuBey7S","outputId":"5ce11c1e-a7c3-4570-a741-1050bb9028c0","executionInfo":{"status":"error","timestamp":1676977663828,"user_tz":-360,"elapsed":353443,"user":{"displayName":"Neloy.","userId":"12580598278832678789"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Epoch 1/10\n","126/126 [==============================] - ETA: 0s - loss: 0.8341 - accuracy: 0.6764\n","Epoch 1: val_accuracy improved from -inf to 0.75373, saving model to /gdrive/MyDrive/BoneFractureWork/Saved_models/New/Checkpoints/InceptionV3_Shoulder_FD/2023_02_21-11_01_51.hdf5\n","126/126 [==============================] - 60s 398ms/step - loss: 0.8341 - accuracy: 0.6764 - val_loss: 0.5239 - val_accuracy: 0.7537 - lr: 1.0000e-04\n","Epoch 2/10\n","126/126 [==============================] - ETA: 0s - loss: 0.6096 - accuracy: 0.7707\n","Epoch 2: val_accuracy improved from 0.75373 to 0.77239, saving model to /gdrive/MyDrive/BoneFractureWork/Saved_models/New/Checkpoints/InceptionV3_Shoulder_FD/2023_02_21-11_01_51.hdf5\n","126/126 [==============================] - 48s 379ms/step - loss: 0.6096 - accuracy: 0.7707 - val_loss: 0.4723 - val_accuracy: 0.7724 - lr: 1.0000e-04\n","Epoch 3/10\n","126/126 [==============================] - ETA: 0s - loss: 0.4072 - accuracy: 0.8516\n","Epoch 3: val_accuracy did not improve from 0.77239\n","126/126 [==============================] - 48s 377ms/step - loss: 0.4072 - accuracy: 0.8516 - val_loss: 0.4903 - val_accuracy: 0.7724 - lr: 1.0000e-04\n","Epoch 4/10\n","126/126 [==============================] - ETA: 0s - loss: 0.2026 - accuracy: 0.9341\n","Epoch 4: val_accuracy improved from 0.77239 to 0.79478, saving model to /gdrive/MyDrive/BoneFractureWork/Saved_models/New/Checkpoints/InceptionV3_Shoulder_FD/2023_02_21-11_01_51.hdf5\n","126/126 [==============================] - 49s 384ms/step - loss: 0.2026 - accuracy: 0.9341 - val_loss: 0.6996 - val_accuracy: 0.7948 - lr: 1.0000e-04\n","Epoch 5/10\n","126/126 [==============================] - ETA: 0s - loss: 0.0879 - accuracy: 0.9718\n","Epoch 5: val_accuracy did not improve from 0.79478\n","126/126 [==============================] - 47s 372ms/step - loss: 0.0879 - accuracy: 0.9718 - val_loss: 0.7675 - val_accuracy: 0.7836 - lr: 1.0000e-04\n","Epoch 6/10\n"," 12/126 [=>............................] - ETA: 41s - loss: 0.0561 - accuracy: 0.9844"]},{"output_type":"error","ename":"KeyboardInterrupt","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-62-2977e6a10350>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0mcall_backs_InceptionV3\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mCallbacks\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"InceptionV3_Shoulder_FD\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      2\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 3\u001b[0;31m Model_InceptionV3.fit(\n\u001b[0m\u001b[1;32m      4\u001b[0m     \u001b[0mx\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtrain_ds\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m     \u001b[0mepochs\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;36m10\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/keras/utils/traceback_utils.py\u001b[0m in \u001b[0;36merror_handler\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m     63\u001b[0m         \u001b[0mfiltered_tb\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     64\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 65\u001b[0;31m             \u001b[0;32mreturn\u001b[0m \u001b[0mfn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     66\u001b[0m         \u001b[0;32mexcept\u001b[0m \u001b[0mException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     67\u001b[0m             \u001b[0mfiltered_tb\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0m_process_traceback_frames\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m__traceback__\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/keras/engine/training.py\u001b[0m in \u001b[0;36mfit\u001b[0;34m(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq, max_queue_size, workers, use_multiprocessing)\u001b[0m\n\u001b[1;32m   1648\u001b[0m                         ):\n\u001b[1;32m   1649\u001b[0m                             \u001b[0mcallbacks\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mon_train_batch_begin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mstep\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1650\u001b[0;31m                             \u001b[0mtmp_logs\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtrain_function\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0miterator\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   1651\u001b[0m                             \u001b[0;32mif\u001b[0m \u001b[0mdata_handler\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshould_sync\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   1652\u001b[0m                                 \u001b[0mcontext\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0masync_wait\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/util/traceback_utils.py\u001b[0m in \u001b[0;36merror_handler\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m    148\u001b[0m     \u001b[0mfiltered_tb\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    149\u001b[0m     \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 150\u001b[0;31m       \u001b[0;32mreturn\u001b[0m \u001b[0mfn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    151\u001b[0m     \u001b[0;32mexcept\u001b[0m \u001b[0mException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    152\u001b[0m       \u001b[0mfiltered_tb\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0m_process_traceback_frames\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m__traceback__\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args, **kwds)\u001b[0m\n\u001b[1;32m    878\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    879\u001b[0m       \u001b[0;32mwith\u001b[0m \u001b[0mOptionalXlaContext\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_jit_compile\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 880\u001b[0;31m         \u001b[0mresult\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_call\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwds\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    881\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    882\u001b[0m       \u001b[0mnew_tracing_count\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexperimental_get_tracing_count\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py\u001b[0m in \u001b[0;36m_call\u001b[0;34m(self, *args, **kwds)\u001b[0m\n\u001b[1;32m    910\u001b[0m       \u001b[0;31m# In this case we have created variables on the first call, so we run the\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    911\u001b[0m       \u001b[0;31m# defunned version which is guaranteed to never create variables.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 912\u001b[0;31m       \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_no_variable_creation_fn\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m*\u001b[0m\u001b[0margs\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0mkwds\u001b[0m\u001b[0;34m)\u001b[0m  \u001b[0;31m# pylint: disable=not-callable\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    913\u001b[0m     \u001b[0;32melif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_variable_creation_fn\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    914\u001b[0m       \u001b[0;31m# Release the lock early so that multiple threads can perform the call\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/polymorphic_function/tracing_compiler.py\u001b[0m in \u001b[0;36m__call__\u001b[0;34m(self, *args, **kwargs)\u001b[0m\n\u001b[1;32m    132\u001b[0m       (concrete_function,\n\u001b[1;32m    133\u001b[0m        filtered_flat_args) = self._maybe_define_function(args, kwargs)\n\u001b[0;32m--> 134\u001b[0;31m     return concrete_function._call_flat(\n\u001b[0m\u001b[1;32m    135\u001b[0m         filtered_flat_args, captured_inputs=concrete_function.captured_inputs)  # pylint: disable=protected-access\n\u001b[1;32m    136\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py\u001b[0m in \u001b[0;36m_call_flat\u001b[0;34m(self, args, captured_inputs, cancellation_manager)\u001b[0m\n\u001b[1;32m   1743\u001b[0m         and executing_eagerly):\n\u001b[1;32m   1744\u001b[0m       \u001b[0;31m# No tape is watching; skip to running the function.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 1745\u001b[0;31m       return self._build_call_outputs(self._inference_function.call(\n\u001b[0m\u001b[1;32m   1746\u001b[0m           ctx, args, cancellation_manager=cancellation_manager))\n\u001b[1;32m   1747\u001b[0m     forward_backward = self._select_forward_and_backward_functions(\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py\u001b[0m in \u001b[0;36mcall\u001b[0;34m(self, ctx, args, cancellation_manager)\u001b[0m\n\u001b[1;32m    376\u001b[0m       \u001b[0;32mwith\u001b[0m \u001b[0m_InterpolateFunctionError\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    377\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mcancellation_manager\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 378\u001b[0;31m           outputs = execute.execute(\n\u001b[0m\u001b[1;32m    379\u001b[0m               \u001b[0mstr\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msignature\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mname\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    380\u001b[0m               \u001b[0mnum_outputs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_num_outputs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.8/dist-packages/tensorflow/python/eager/execute.py\u001b[0m in \u001b[0;36mquick_execute\u001b[0;34m(op_name, num_outputs, inputs, attrs, ctx, name)\u001b[0m\n\u001b[1;32m     50\u001b[0m   \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     51\u001b[0m     \u001b[0mctx\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mensure_initialized\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 52\u001b[0;31m     tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,\n\u001b[0m\u001b[1;32m     53\u001b[0m                                         inputs, attrs, num_outputs)\n\u001b[1;32m     54\u001b[0m   \u001b[0;32mexcept\u001b[0m \u001b[0mcore\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_NotOkStatusException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}],"source":["call_backs_InceptionV3 = Callbacks(\"InceptionV3_Shoulder_FD\") \n","\n","Model_InceptionV3.fit(\n","    x = train_ds,\n","    epochs = 10,\n","    validation_data = val_ds,\n","    validation_freq = 1,\n","    callbacks = call_backs_InceptionV3\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-PGpHXizWNYJ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1676977690105,"user_tz":-360,"elapsed":22636,"user":{"displayName":"Neloy.","userId":"12580598278832678789"}},"outputId":"a3025a07-8dae-45ff-9622-3540c14cd79a"},"outputs":[{"output_type":"stream","name":"stdout","text":["10/10 [==============================] - 20s 320ms/step\n"]}],"source":["Predictions = Model_InceptionV3.predict(test_ds)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4vDoeO1ty1wN"},"outputs":[],"source":["def get_labels(predictions):\n","  Y_pred = []\n","  Y_true = []\n","  for i in range(len(predictions)):\n","    Y_pred.append(Unique_labels[predictions[i].argmax()])\n","    Y_true.append(Unique_labels[Y_test[i].argmax()])\n","  return Y_pred, Y_true"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"N2oWBIXvy9Vl"},"outputs":[],"source":["Y_pred, Y_true = get_labels(Predictions)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0xhve-mUgbAl"},"outputs":[],"source":["Y_pred"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ZPMNncI6hCwk"},"outputs":[],"source":["Y_test"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TUi_0LpKZmhK","colab":{"base_uri":"https://localhost:8080/","height":36},"executionInfo":{"status":"ok","timestamp":1676977702540,"user_tz":-360,"elapsed":2015,"user":{"displayName":"Neloy.","userId":"12580598278832678789"}},"outputId":"59d033b9-b73a-408a-ae92-27dd27df1957"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["'/gdrive/MyDrive/BoneFractureWork/Saved_models/New/Models/InceptionV3_Shoulder_FD/2023_02_21-11_08_22.h5'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":67}],"source":["save_model(Model_InceptionV3, \"InceptionV3_Shoulder_FD\")"]},{"cell_type":"markdown","metadata":{"id":"1sOoUWllzxN6"},"source":["## **`Model evaluation`**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1676977690106,"user":{"displayName":"Neloy.","userId":"12580598278832678789"},"user_tz":-360},"id":"3CZ14a9F1NnC","outputId":"6b6af1c8-b172-460a-bc14-03d4144693c0"},"outputs":[{"output_type":"stream","name":"stdout","text":["\n","InceptionV3 Model's Accuracy: 76.71%\n","\n","                        Fractured Shoulder  Non-fractured Shoulder\n","Fractured Shoulder                     223                      89\n","Non-fractured Shoulder                  57                     258\n","\n","InceptionV3's Model's classification report: \n","\n","                        precision    recall  f1-score   support\n","\n","    Fractured Shoulder       0.80      0.71      0.75       312\n","Non-fractured Shoulder       0.74      0.82      0.78       315\n","\n","              accuracy                           0.77       627\n","             macro avg       0.77      0.77      0.77       627\n","          weighted avg       0.77      0.77      0.77       627\n","\n"]}],"source":["Model_Evaluation( Y_true = Y_true, Y_pred = Y_pred, Labels = Unique_labels, suffix = \"InceptionV3\")"]}],"metadata":{"accelerator":"GPU","colab":{"provenance":[{"file_id":"1xFvwqrtGohsAhQuwG0_3wxS6u7Q-kTKd","timestamp":1673037250391}]},"gpuClass":"standard","kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}